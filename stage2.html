<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>What's in Your Hand?｜第二階段（題目）</title>

  <!-- iOS 全螢幕 / 加到主畫面 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="What's in Your Hand?">
  <link rel="apple-touch-icon" href="icon.png">

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- iPad 最佳化 viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
.outer{
  width:100vw;
  height:100vh;
  overflow:hidden;
  display:grid;
  place-items:center;
  background:#ffffff;
}
.fit{
  width:1366px;
  height:1024px;
  transform-origin:center center;
  transform:scale(calc(min(100vw/1366, (var(--vh, 1vh)*100)/1024)));
  background:#ffffff;
}
/* 禁止選取、長按、彈性捲動（沉浸式） */
    html,body{height:100%;margin:0;overscroll-behavior:none;touch-action:none;background:#fff;}
    *{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;}
    input,textarea{-webkit-user-select:text;user-select:text;-webkit-touch-callout:default;}

    /* 將舞台等比縮放至 1366×1024，避免超出 iPad 螢幕 */
    
      
  
  
}

    :root{ --bg:#ffffff; --text:#3b3f44; --muted:#6b7076; --pill:#bfefff; --pill-hover:#a8e6ff; }
    body{font-family:"Manrope","Noto Sans TC",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--text);}

    .stage{width:1366px;height:1024px;position:relative;}
    .wrap{position:absolute;left:50%;top:130px;transform:translateX(-50%);width:920px;}
    .q{text-align:center;font-size:34px;line-height:1.9;margin:0 0 34px;white-space:pre-line;}
    .options{display:grid;gap:28px;justify-items:center;}
    .opt{
      width:75%;max-width:680px;display:block;text-decoration:none;border:none;
      background:var(--pill);color:#1f2a33;padding:22px 28px;border-radius:22px;
      box-shadow:0 6px 0 rgba(0,0,0,.12),0 12px 32px rgba(0,0,0,.06);
      font:900 26px "Noto Sans TC",sans-serif;text-align:center;cursor:pointer;
      transition:transform .08s ease, background .15s ease, box-shadow .15s ease;
    }
    .opt:hover{background:var(--pill-hover);transform:translateY(-1px);box-shadow:0 7px 0 rgba(0,0,0,.12),0 14px 36px rgba(0,0,0,.08);}
    .opt:active{transform:translateY(1px);box-shadow:0 4px 0 rgba(0,0,0,.12),0 8px 20px rgba(0,0,0,.06);}
    .meta{position:absolute;left:50%;bottom:48px;transform:translateX(-50%);color:var(--muted);font-weight:700;font-size:20px;}
</style>
  <style>
.outer{
  width:100vw;
  height:100vh;
  overflow:hidden;
  display:grid;
  place-items:center;
  background:#ffffff;
}
.fit{
  width:1366px;
  height:1024px;
  transform-origin:center center;
  transform:scale(calc(min(100vw/1366, (var(--vh, 1vh)*100)/1024)));
  background:#ffffff;
}
/* iPad / iOS Safari：避免 100vh 位移 */
   /* 先給舊機 fallback */
  @supports (height: 100dvh) {
     /* 新版 iOS / iPadOS 用 dvh */
  }
  /* 再準備一個 --vh 變數備援（超舊版 iOS 也穩）*/
  .outer.use-vh-var{ height: calc(var(--vh, 1vh) * 100); }
</style>
<script>
  // 讓極端情境下也穩：用 visualViewport 設定 --vh
  (function(){
    function setVH(){
      var h = (window.visualViewport ? window.visualViewport.height : window.innerHeight);
      document.documentElement.style.setProperty('--vh', (h * 0.01) + 'px');
    }
    setVH();
    window.addEventListener('resize', setVH);
    window.addEventListener('orientationchange', setVH);
    // 給 .outer 一個 class 以啟用備援
    addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.outer').forEach(n => n.classList.add('use-vh-var'));
    });
  })();
</script>
</head>
<body>
  <div class="outer">
    <div class="stage fit">
      <div class="wrap">
        <h2 id="question" class="q"></h2>
        <div id="options" class="options"></div>
      </div>
      <div class="meta">
        <div id="counter">1 / 5</div>
      </div>
    </div>
  </div>

  <script>
    // 優先讀前導頁寫入的分流；支援 ?force= 測試；否則看第一階段最高分
    const base = JSON.parse(localStorage.getItem('handname_scores')||'{}');
    const types = ['extravert','introvert','caring','decisive','analytic'];
    const force = new URLSearchParams(location.search).get('force');

    function pickType(){
      const fromIntro = sessionStorage.getItem('handname_stage2_type');
      if(fromIntro && types.includes(fromIntro)) return fromIntro;
      if(force && types.includes(force)) return force;
      let best='extravert', val=-Infinity;
      types.forEach(k=>{ const v=base[k]||0; if(v>val){best=k;val=v;} });
      return best;
    }
    const type = pickType();

    // 題庫（完整）
    const DB = {
      extravert: {
        keyMap: {playful:'淘氣', humorous:'幽默', lively:'活潑', generous:'大方'},
        items:[
          {q:'突然，一顆迪斯可球從天空中墜落，打亂了舞台的節奏。所有的人都慌成一團，你第一反應是？', opts:[
            {t:'把迪斯可球踢回天空！帥氣又有點壞。', k:'playful'},
            {t:'開玩笑說「這是我的歡迎禮嗎？」逗大家笑', k:'humorous'},
            {t:'用手拍出剛剛的節奏，試著重新帶動氣氛。', k:'lively'},
          ]},
          {q:'因為你，派對順利回到原本的樣子。這時一位居民走向前，比出「謝謝」的手語，你會怎麼回應？', opts:[
            {t:'大力揮手鞠躬，露出調皮笑容回應不客氣。', k:'generous'},
            {t:'笑著說：「小事！」並拉著對方的手一起跳舞', k:'playful'},
            {t:'誠懇回應，然後詢問對方不客氣的手語', k:'humorous'},
          ]},
          {q:'派對來到高潮，每個人要來到台前 solo 一段，你想做出什麼表演？', opts:[
            {t:'從桌上隨機抓一頂奇怪的帽子戴上，跳滑稽的舞步', k:'lively'},
            {t:'唱一首大家都會的歌曲，活絡氣氛', k:'generous'},
            {t:'用誇張的語氣和肢體動作講一個冷笑話', k:'playful'},
          ]},
          {q:'派對即將結束，音樂緩和下來，燈光也逐漸柔和，在不打擾氣氛的情況下，你想怎麼做？', opts:[
            {t:'趁沒人注意躲到旁邊偷吃桌上的零食', k:'humorous'},
            {t:'發一篇限時動態記錄當下', k:'lively'},
            {t:'隨著音樂搖擺，享受當下', k:'generous'},
          ]},
          {q:'派對結束，你要怎麼跟大家告別？', opts:[
            {t:'微笑著說完再見就直接離去', k:'playful'},
            {t:'做出一個搞怪的動作，讓大家留下印象', k:'humorous'},
            {t:'跑到台上拿起麥克風，演講今天的心得', k:'lively'},
          ]},
        ]
      },
      introvert: {
        keyMap:{calm:'冷靜', gentle:'文靜', steady:'沉穩', shy:'害羞'},
        items:[
          {q:'剛踏入花園，你會怎麼形容當下的心情？', opts:[
            {t:'覺得柔和安靜，想要直接躺下來', k:'calm'},
            {t:'想把這片景色拍下來紀念', k:'gentle'},
            {t:'內心感到一股踏實，想探索每個角落。', k:'steady'},
          ]},
          {q:'此時，一個熱心的居民走向前表示想帶你參加花園導覽，你會怎麼做？', opts:[
            {t:'雖然更想一個人遊覽，但不好意思拒絕還是接受', k:'shy'},
            {t:'拒絕好意，決定自己一個人探索', k:'calm'},
            {t:'覺得很開心，交給專業的來介紹準沒錯', k:'gentle'},
          ]},
          {q:'走著走著，你發現一株從未見過的奇異植物，你會怎麼做？', opts:[
            {t:'可能有毒，還是不要靠近比較好', k:'steady'},
            {t:'覺得很新奇，在一旁默默觀察他', k:'shy'},
            {t:'詢問身邊的人關於它的資訊', k:'calm'},
          ]},
          {q:'你開始感到走到有點累了，你想怎麼休息？', opts:[
            {t:'靠在長椅上戴起耳機聽音樂', k:'gentle'},
            {t:'就地閉上眼睛深呼吸片刻', k:'steady'},
            {t:'站在一個角落享受片刻安靜', k:'shy'},
          ]},
          {q:'休息完後準備離開，你想用什麼方式記錄整天的心情？', opts:[
            {t:'用表格整理出今天的所見所聞', k:'calm'},
            {t:'發一篇文字很多的社群貼文', k:'gentle'},
            {t:'默默記在心裡，享受當下', k:'steady'},
          ]},
        ]
      },
      caring: {
        keyMap:{soft:'溫柔', kind:'善良', patient:'耐心', upbeat:'樂觀'},
        items:[
          {q:'剛踏入這個地方，四周的光點慢慢漂浮起來，你會怎麼反應？', opts:[
            {t:'伸手輕輕碰觸，想看看這些光的觸感是什麼。', k:'soft'},
            {t:'被光點包圍的感覺太美了，心情都好了起來。', k:'kind'},
            {t:'想辦法收集起散亂的光點，恢復秩序', k:'patient'},
          ]},
          {q:'有個光點突然變得灰暗，看起來像是在低落，你會怎麼做？', opts:[
            {t:'所有情緒都有存在的意義，先裝起來不管他', k:'upbeat'},
            {t:'慢慢靠近他，給他一點時間冷靜下來', k:'soft'},
            {t:'做鬼臉或一切方式想辦法讓他開心起來！', k:'kind'},
          ]},
          {q:'突然一位居民不小心把光點撞得滿天飛，你會？', opts:[
            {t:'告訴他沒事並讓他慢慢收拾', k:'patient'},
            {t:'邊笑邊安慰他「這樣更漂亮」', k:'upbeat'},
            {t:'一顆一顆幫忙撿回去，怕他尷尬。', k:'soft'},
          ]},
          {q:'一顆特別亮的光點飄到你手中，它好像有些故事想讓你知道，你覺得它要說什麼？', opts:[
            {t:'「別忘了自己也要好好休息。」', k:'kind'},
            {t:'「收拾完後，我們再出發吧！」', k:'patient'},
            {t:'「沒事的，一切都會好起來。」', k:'upbeat'},
          ]},
          {q:'結束整理後，你可以帶走一顆屬於自己的光點作紀念，你想帶哪一顆？', opts:[
            {t:'看起來柔柔亮亮，很安靜的那顆', k:'soft'},
            {t:'一閃一閃，像在笑的那顆', k:'kind'},
            {t:'顏色最溫暖，讓人覺得安心的那顆', k:'patient'},
          ]},
        ]
      },
      decisive: {
        keyMap:{brave:'勇敢', confident:'自信', resolute:'果斷', independent:'獨立'},
        items:[
          {q:'眼前出現三條道路，一條充滿霧氣、一條燈光亮得刺眼、一條安靜的詭異。你會怎麼走？', opts:[
            {t:'選最危險的那條，我天生喜歡冒險', k:'brave'},
            {t:'走自己覺得順眼的那條，不聽別人意見', k:'confident'},
            {t:'仔細判斷哪條最有勝算，決定後就不回頭', k:'resolute'},
          ]},
          {q:'前方突然障礙物，是充滿謎題的陷阱門，這時你會？', opts:[
            {t:'繞道而行，一定有其他出口', k:'independent'},
            {t:'指揮大家分工完成', k:'brave'},
            {t:'相信自己能克服，獨立完成關卡', k:'confident'},
          ]},
          {q:'在往前走，遇到一隻卡關的居民求助，他請你幫忙按下開關，你會？', opts:[
            {t:'分析整個機關怎麼動再幫', k:'resolute'},
            {t:'教他自己怎麼開，然後走自己的路', k:'independent'},
            {t:'二話不說直接幫他按', k:'brave'},
          ]},
          {q:'終點出現一個會說話的寶箱，它說：「只有回答正確的人能打開我。」你覺得它想聽什麼？', opts:[
            {t:'「我相信自己就是答案。」', k:'confident'},
            {t:'「我不怕錯，先開了再說！」', k:'resolute'},
            {t:'「我不靠你，我自己有我想要的東西。」', k:'independent'},
          ]},
          {q:'挑戰結束，獲得一枚徽章，你會選擇？', opts:[
            {t:'最亮的那顆，象徵無所畏懼', k:'brave'},
            {t:'最大的那顆，象徵胸有成竹', k:'confident'},
            {t:'最硬的那顆，象徵意志堅強', k:'resolute'},
          ]},
        ]
      },
      analytic: {
        keyMap:{acute:'敏銳', careful:'細心', smart:'聰明', prudent:'謹慎'},
        items:[
          {q:'桌上散落各種零件，你第一步會做什麼？', opts:[
            {t:'觀察所有零件，找到其中規律', k:'acute'},
            {t:'小心分類，讓每個零件都放在對位置', k:'careful'},
            {t:'拿起工具，直接操作試著理解運作方式', k:'smart'},
          ]},
          {q:'這時候一位居民拿出一個半完成的裝置，希望你協助他完成，在開始之前你會向對方詢問什麼問題？', opts:[
            {t:'「你確定每個零件都放好，沒有缺漏嗎？」', k:'prudent'},
            {t:'「你希望這個裝置最後能達成什麼效果？」', k:'acute'},
            {t:'「你覺得這個裝置的運作原理是什麼？」', k:'careful'},
          ]},
          {q:'忽然，裝置自己啟動，零件開始亂轉，你會？', opts:[
            {t:'找到問題源頭，自己慢慢解決', k:'smart'},
            {t:'詢問工坊內專業人士幫助', k:'prudent'},
            {t:'立刻按下緊急開關，避免更多混亂', k:'acute'},
          ]},
          {q:'組裝的過程中，有一個零件你不確定是不是放錯了，你覺得應該怎麼辦？', opts:[
            {t:'成果精確，全部從頭開始組裝', k:'careful'},
            {t:'根據原理和邏輯推測正確位置，再試著裝上去', k:'smart'},
            {t:'為了維持進度，先暫時放置，等完成再檢查', k:'prudent'},
          ]},
          {q:'任務完成，在離開工坊之前，你可以啟動一個裝置，改變這個世界所有人，你會選擇哪個？', opts:[
            {t:'能看透任何人的想法與感受', k:'acute'},
            {t:'能解析錯誤的訊息或事件', k:'careful'},
            {t:'能預知未來的可能', k:'smart'},
          ]},
        ]
      },
    };

    const storeKey = 'handname_stage2';
    const scores2 = JSON.parse(localStorage.getItem(storeKey)||'{}');
    const set = DB[type];
    const qEl = document.getElementById('question');
    const opsEl = document.getElementById('options');
    const counterEl = document.getElementById('counter');

    // 將中文逗號、句號視為「可斷點」，並只輸出兩行
    const punctToBreaks = (txt) => txt.replaceAll(/([，。])/g, '$1|');
    function toTwoLines(txt){
      const parts = punctToBreaks(txt).split('|').filter(s=>s.length);
      if(parts.length <= 2) return parts.join('<br>');
      const lens = parts.map(p=>p.length);
      const total = lens.reduce((a,b)=>a+b,0);
      let bestIdx = 0, diff = Infinity, sum = 0;
      for(let i=0;i<lens.length-1;i++){
        sum += lens[i];
        const d = Math.abs(sum - total/2);
        if(d < diff){ diff = d; bestIdx = i; }
      }
      const line1 = parts.slice(0,bestIdx+1).join('');
      const line2 = parts.slice(bestIdx+1).join('');
      return `${line1}<br>${line2}`;
    }

    let idx = 0;

    function render(){
      if(!set){ // 安全防呆：若沒有題庫（理論上不會發生）
        qEl.textContent = '（讀取題目失敗，請返回上一頁重試）';
        opsEl.innerHTML = '';
        counterEl.textContent = '—';
        return;
      }
      const item = set.items[idx];
      qEl.innerHTML = toTwoLines(item.q);
      opsEl.innerHTML = '';
      item.opts.forEach(o=>{
        const b = document.createElement('button');
        b.className = 'opt';
        b.type = 'button';
        b.textContent = o.t;
        b.addEventListener('click', ()=>choose(o.k));
        opsEl.appendChild(b);
      });
      counterEl.textContent = `${idx+1} / ${set.items.length}`;
    }

    function choose(key){
      const label = set.keyMap[key] || key;
      const bucket = `${type}:${label}`;
      scores2[bucket] = (scores2[bucket]||0) + 1;
      localStorage.setItem(storeKey, JSON.stringify(scores2));
      idx++;
      if(idx<set.items.length){ render(); }
      else { window.location.href='stage3.html'; }
    }

    // 快捷鍵
    window.addEventListener('keydown',(e)=>{
      if(['1','2','3'].includes(e.key)){
        const n=parseInt(e.key,10)-1;
        const item=set.items[idx];
        if(item&&item.opts[n]) choose(item.opts[n].k);
      }
    });

    render();
  </script>
</body>
</html>
